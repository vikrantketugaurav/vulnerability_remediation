


#Note: 
#To disable Null Session

$ErrorActionPreference="SilentlyContinue"
Stop-Transcript | out-null
$ErrorActionPreference = "Continue"

if(!(Test-path "C:\Null_Session"))
{
    New-Item -path "C:\Null_Session" -ItemType directory -force
}

Start-Transcript -path "C:\Null_Session\Null_Session_Log.log" –append 

$registryPath = "HKLM:\SYSTEM\CurrentControlSet\Control\Lsa"
$name1= "restrictanonymous"
$name2= "restrictanonymoussam"
$name3= "everyoneincludesanonymous"
$value1 = "1"
$value2 = "1"
$value3 = "0"

if(!(Test-path "C:\Null_Session\Null_Session.reg"))
{
Reg export "HKLM\SYSTEM\CurrentControlSet\Control\Lsa" "C:\Null_Session\Null_Session.reg"

}
IF(!(Test-Path $registryPath))
{
New-ItemProperty -Path $registryPath -Name $name1 -Value $value1 -PropertyType DWORD -Force 
New-ItemProperty -Path $registryPath -Name $name2 -Value $value2 -PropertyType DWORD -Force 
New-ItemProperty -Path $registryPath -Name $name3 -Value $value3 -PropertyType DWORD -Force 
}
ELSE
{
New-ItemProperty -Path $registryPath -Name $name1 -Value $value1 -PropertyType DWORD -Force
New-ItemProperty -Path $registryPath -Name $name2 -Value $value2 -PropertyType DWORD -Force
New-ItemProperty -Path $registryPath -Name $name3 -Value $value3 -PropertyType DWORD -Force

}


Stop-Transcript