
# Note :
# 1. The user running the script must have administrative privileges.
# 2. The log file for the script will be generated at 'C:/D_Credential' location where the script is running.
# 3. Please ensure to change the '$testpath1' & '$testpath2' with the installed Jboss server directory path
# 4. Restart the server to take effect the changes.


$ErrorActionPreference="SilentlyContinue"
Stop-Transcript | out-null
$ErrorActionPreference = "Continue"

if(!(Test-path "C:\D_Credential"))
{
    New-Item -path "C:\D_Credential" -ItemType directory -force
}

Start-Transcript -path "C:\D_Credential\D_Credential_Log.log" –append 
Write-Output "`n`n"
Write-Output "********************** Transcription started for D_Credential_VulnerabilityFix ***********************"



$testpath1 = "C:\jboss-5.1.0.GA\jboss-5.1.0.GA\server\default\conf\props" ;
$file1 = "jmx-console-users.properties"
$bkpFile1 = "jmx-console-users_bkp.properties"


if(!(Test-Path $testpath1\$bkpFile1)){
    New-Item $testpath1\$bkpFile1 -type file
    Copy-Item  $testpath1\$file1 $testpath1\$bkpFile1
    Write-Output "jmx-console-users.properties file backup created successfully"
}

$testpath2 = "C:\jboss-5.1.0.GA\jboss-5.1.0.GA\server\default\conf\props" ;
$file2 = "jmx-console-roles.properties"
$bkpFile2 = "jmx-console-roles_bkp.properties"


if(!(Test-Path $testpath2\$bkpFile2)){
    New-Item $testpath2\$bkpFile2 -type file
    Copy-Item  $testpath2\$file2 $testpath2\$bkpFile2
    Write-Output "jmx-console-roles.properties file backup created successfully"
}

$path1=gci $testpath1\$file1 -Recurse

$path1.fullname | ForEach-Object {(GC $_ -Raw).Replace('admin=admin','dhinchak=pooja')| Set-Content $_}

$path2=gci $testpath2\$file2 -Recurse

$path2.fullname | ForEach-Object {(GC $_ -Raw).Replace('admin','dhinchak')| Set-Content $_}


Stop-Transcript 