
#Note:
 
# 1. The user running the script must have administrative privileges.
# 2. The log file for the script will be generated as 'C:\SNMP_Response\SNMP_Response-_Log.log'.
# 3. A .txt file(C:\SNMP_Response\SNMP_Response-.txt) will be created for saving the values of parameters without name.
# 4. A .reg file(C:\SNMP_Response\SNMP_Response-.reg) will be created as backup for importing the values of parameters while





$ErrorActionPreference="SilentlyContinue"
Stop-Transcript | out-null
$ErrorActionPreference = "Continue"

if(!(Test-path "C:\SNMP_Response"))
{
    New-Item -path "C:\SNMP_Response" -ItemType directory -force
}

Start-Transcript -path "C:\SNMP_Response\SNMP_Response-_Log.log" –append  



Write-Output "*****************SNMP_Response-_log file started****************"
Write-Output "`n`n`n`n" 

$registryPath = "HKLM:\SYSTEM\CurrentControlSet\Services\SNMP"
$Key = "Parameters"
$name = "PolicyNotificationRetries"


function Test-RegistryValue {

    param (

     [parameter(Mandatory=$true)]
     [ValidateNotNullOrEmpty()]$Path,

    [parameter(Mandatory=$true)]
     [ValidateNotNullOrEmpty()]$Value
    )

    try {
        Get-ItemProperty -Path $Path -name $Value -ErrorAction Stop | Out-Null
        return $true
    }

    catch {
        return $false
    }
}


$chk=test-path $registryPath\$Key

if("False" -eq $chk -and (!(Test-path "C:\SNMP_Response\SNMP_Response-.txt")))
{
    $chk>"C:\SNMP_Response\SNMP_Response.txt"
}
else
{
    $chk1=Test-RegistryValue -Path "HKLM:\System\CurrentControlSet\Services\SNMP\Parameters" -Value "PolicyNotificationRetries"
    if("True" -eq $chk -and  "False" -eq $chk1 -and (!(Test-path "C:\SNMP_Response\SNMP_Response.txt")))
    {
        $chk>"C:\SNMP_Response\SNMP_Response.txt"
        $chk1>>"C:\SNMP_Response\SNMP_Response.txt"
    }
    elseif("True" -eq $chk -and  "True" -eq $chk1 -and (!(Test-path "C:\SNMP_Response\SNMP_Response.reg")))
    {
        Reg export HKLM\System\CurrentControlSet\Services\SNMP\Parameters C:\SNMP_Response\SNMP_Response.reg

    }
}

if (!(test-path $registryPath\$Key))
{
    New-Item -Path $registryPath -name $Key
    new-itemproperty -path $registryPath\$Key -name $name -value 5 -propertytype dword -force
}
elseif (test-path $registryPath\$Key)
{
    new-itemproperty -path $registryPath\$Key -name $name -value 5 -propertytype dword -force
}
Write-Output "SNMP is started"

Write-Output "`n`n`n`n" 

Write-Output "*****************SNMP_Response_log file started****************"

Stop-Transcript 